# 課題1 （質問）

## サードパーティクッキーとファーストパーティクッキーの違いを説明してください

ファーストパーティークッキーはユーザーがアクセスしているサイトのドメインで発行されたクッキーであり、<br>
サードパーティークッキーはユーザーがアクセスしているサイトに表示された別サイトのバナー広告など、「別ドメインで発行されたクッキー」のことを指します。


## サードパーティ Cookie を用いて広告配信ネットワーク（例えばGoogle AdSense など）がどのようにユーザの訪問履歴を把握しているのか、説明してください

Google adsense広告に含まれるサードパーティクッキーは、どのサイトに組み込まれているものか、
ということがアドセンス側でわかります。
加えてユーザーがサードパーティクッキーを受け入れる状態の場合、「このユーザーがこのサイトのサードパーティクッキーを利用した、ということもわかります。
そのため複数のサイトA、B、C、、、など、多数のサイトにサードパーティクッキーを設定しておくことで、
ユーザーがどのようなサイトにアクセスしているか、の行動履歴が認識できます。

ユーザー1 車のサイトと、ゲームのサイトのサードパーティクッキーを利用した
ユーザー2 服のサイトのサードパーティクッキーを利用した

これらの情報がアドセンス側で把握できる、ということになります。




## そもそもサードパーティークッキーはどのように生成されるのでしょうか？画像埋め込みやスクリプト埋め込みなど、様々な手法を説明してください

参考：
https://kimagureneet.hatenablog.com/entry/2016/02/11/104614

facebookのいいねボタンやバナー広告など、専用のコンテンツをサイトに埋め込むケースがあります。

ユーザーがサイトに組み込まれた広告を表示したり、クリックした時に、サードパーティクッキーの提供元のサーバーにリクエストが送られ、サードパーティクッキーが生成されます。



## サードパーティクッキーの扱いはブラウザによってどのような差があるのでしょうか？（特にsafariは他のブラウザと挙動が異なるので、ぜひ調べてみてください！）
safariは　導入済みのITP(Intelligent Tracking Prevention）により段階的に制限を強くしており、
現在はデフォルトでサードパーティクッキーをブロックしています。
frefoxでは新規ユーザーではデフォルトでブロックされており、既存ユーザーは設定で変更が可能です。
グーグルクロームは段階的にブロックを進めています。
どのブラウザにおいても、制限をかけていく方向です。


## ドメインは同一で、ポートが異なるクッキーはファーストパーティクッキーでしょうか？サードパーティクッキーでしょうか？（hoge.com:8080とhoge.com:8081など）
訪問しているWebサイトとは異なるドメインから発行されるものがサードパーティクッキーとなります。
ドメインは同じため、ファーストパーティクッキーと思われます。（ちょっとこの問題はっきりとした情報が見つからず、自信なしです。。）


課題２（実装）

    ページの読み込みと同時に、ファーストパーティクッキーと、サードパーティクッキーが設定されるようなWEBサイトを作成してください
    ヒント：設定方法は「画像を取得する際、ヘッダーでクッキーを設定する方法」が最も手軽でしょう
    ブラウザ間にはサードパーティクッキーの扱いに関して差分があります。safariでは設定できるけどchromeでは設定できる...といった状況も多々あるため、特定のブラウザで動作しなければ他のブラウザでも試してみましょう！


仕様

    以下の仕様を満たすようなwebサービスを作成してください
    ドメイン（（例）hoge.com）にアクセスすると、何らかのページが表示される
    ページ自体の内容はなんでも可
    かつ、クッキーが２つ保存される
    クッキー１
    domain=hoge.com
    クッキー２
    domain=xxxxxxxxx.com
    （別ドメインならなんでもOK）
    共通仕様
    name="hoge"など、値はなんでもOK
    httponly属性が付与されている
    ここは大事なポイントです！JavaScriptから生成するのではなく、サーバからのレスポンスでクッキーを生成してください


技術的な仕様

    WEBサーバを作る場合は、node.jsとexpressで作成してみてください（以降の課題でもnode.jsを多用するため、扱いに慣れてもらいたいのです）
    ページを作る際の技術には特に指定がありません。何を使って作成いただいても構いません
    強いて挙げるなら、expressのstatic file servingを使うと手軽にWEBページを作成して返せるので、手軽だと思います
    https://expressjs.com/starter/static-files.html


ヒント

    「この課題のためだけにドメインを2つ取得する必要があるのか・・・」と思われた方。ご安心ください、その必要はありません！
    ngrokというツールを使えば、https対応の簡易的なドメインを自分のローカル環境のプロセスに接続できます
    https://ngrok.com/


    ngrokは「ngrok.io」までがpublic suffixとして登録されているため、xxx.ngrok.ioとyyy.ngrok.ioは別のドメインと判定されます
    なのでngrok２台を立ち上げる、あるいは片方のサーバをlocalhostでもう片方のサーバをngrokで立ち上げれば、異なるドメインのサーバを簡易的に用意できます
    ぜひこれを機にngrokの使い方にも慣れてみてください！